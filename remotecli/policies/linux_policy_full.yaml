version: "2024.11-full"
os: "linux"
rules:
  - id: "LIN-FS-001"
    control_id: "LIN.FS.BLACKLIST"
    category: "Filesystem"
    description: "Blacklist unused filesystems"
    check_cmd: ["bash", "-lc", "! lsmod | grep -E '(cramfs|udf|hfs|freevxfs|squashfs|hfsplus|jffs2|fuse|ntfs)'"]
    fix_cmd: ["bash", "-lc", "sudo tee /etc/modprobe.d/ntro-blacklist.conf >/dev/null <<'EOF'\nblacklist cramfs\nblacklist udf\nblacklist hfs\nblacklist freevxfs\nblacklist squashfs\nblacklist hfsplus\nblacklist jffs2\nblacklist fuse\nblacklist ntfs\nEOF\nsudo update-initramfs -u || true"]
    severity: "medium"
    os: "linux"
  - id: "LIN-FS-002"
    control_id: "LIN.FS.PARTITIONS"
    category: "Filesystem"
    description: "Separate partitions present (/tmp,/var,/var/log,/var/log/audit)"
    check_cmd: ["bash", "-lc", "grep -E '^(tmpfs|/dev/)' /etc/fstab | grep -E '/tmp|/var |/var/log |/var/log/audit'"]
    fix_cmd: ["bash", "-lc", "echo 'Ensure separate partitions are configured in /etc/fstab' && exit 1"]
    severity: "high"
    os: "linux"
  - id: "LIN-FS-003"
    control_id: "LIN.FS.TMPFLAGS"
    category: "Filesystem"
    description: "/tmp mounted with nodev,nosuid,noexec"
    check_cmd: ["bash", "-lc", "findmnt -no OPTIONS /tmp | grep -qi 'nodev' && findmnt -no OPTIONS /tmp | grep -qi 'nosuid' && findmnt -no OPTIONS /tmp | grep -qi 'noexec'"]
    fix_cmd: ["bash", "-lc", "sudo mount -o remount,nodev,nosuid,noexec /tmp"]
    severity: "high"
    os: "linux"
  - id: "LIN-BOOT-001"
    control_id: "LIN.BOOT.GRUBPWD"
    category: "Boot Hardening"
    description: "GRUB password configured"
    check_cmd: ["bash", "-lc", "grep -E '^GRUB_PASSWORD' /etc/grub.d/* 2>/dev/null || grep -E '^set superusers' /etc/grub.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "echo 'Configure GRUB password per distribution guide' && exit 1"]
    severity: "high"
    os: "linux"
  - id: "LIN-SYSCTL-001"
    control_id: "LIN.KERN.ASLR"
    category: "Kernel Hardening"
    description: "ASLR enabled"
    check_cmd: ["bash", "-lc", "sysctl kernel.randomize_va_space | grep -q '= 2'"]
    fix_cmd: ["bash", "-lc", "echo 'kernel.randomize_va_space=2' | sudo tee /etc/sysctl.d/99-ntro-aslr.conf && sudo sysctl -p /etc/sysctl.d/99-ntro-aslr.conf"]
    severity: "high"
    os: "linux"
  - id: "LIN-SYSCTL-002"
    control_id: "LIN.KERN.PTRACE"
    category: "Kernel Hardening"
    description: "ptrace restricted"
    check_cmd: ["bash", "-lc", "sysctl kernel.yama.ptrace_scope | grep -q '= 1'"]
    fix_cmd: ["bash", "-lc", "echo 'kernel.yama.ptrace_scope=1' | sudo tee /etc/sysctl.d/99-ntro-ptrace.conf && sudo sysctl -p /etc/sysctl.d/99-ntro-ptrace.conf"]
    severity: "medium"
    os: "linux"
  - id: "LIN-DUMP-001"
    control_id: "LIN.KERN.COREDUMP"
    category: "Kernel Hardening"
    description: "Core dumps disabled"
    check_cmd: ["bash", "-lc", "sysctl fs.suid_dumpable | grep -q '= 0'"]
    fix_cmd: ["bash", "-lc", "echo 'fs.suid_dumpable=0' | sudo tee /etc/sysctl.d/99-ntro-dump.conf && sudo sysctl -p /etc/sysctl.d/99-ntro-dump.conf"]
    severity: "medium"
    os: "linux"
  - id: "LIN-LOGIN-001"
    control_id: "LIN.LOGIN.BANNER"
    category: "Login & Banner"
    description: "Banner configured (/etc/issue)"
    check_cmd: ["bash", "-lc", "test -s /etc/issue"]
    fix_cmd: ["bash", "-lc", "echo 'Authorized use only' | sudo tee /etc/issue"]
    severity: "low"
    os: "linux"
  - id: "LIN-SVC-001"
    control_id: "LIN.SVC.DISABLEINSECURE"
    category: "Service Hardening"
    description: "Disable insecure services (telnet,tftp,rsh,ftp)"
    check_cmd: ["bash", "-lc", "for s in telnet tftp rsh ftp; do systemctl is-enabled $s 2>/dev/null | grep -q 'disabled' || exit 1; done"]
    fix_cmd: ["bash", "-lc", "for s in telnet tftp rsh ftp; do sudo systemctl disable --now $s 2>/dev/null || true; done"]
    severity: "high"
    os: "linux"
  - id: "LIN-SVC-002"
    control_id: "LIN.SVC.AUTOFS"
    category: "Service Hardening"
    description: "Disable autofs"
    check_cmd: ["bash", "-lc", "systemctl is-enabled autofs 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now autofs 2>/dev/null || true"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SVC-003"
    control_id: "LIN.SVC.AVAHI"
    category: "Service Hardening"
    description: "Disable avahi-daemon"
    check_cmd: ["bash", "-lc", "systemctl is-enabled avahi-daemon 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now avahi-daemon 2>/dev/null || true"]
    severity: "low"
    os: "linux"
  - id: "LIN-SVC-004"
    control_id: "LIN.SVC.DHCPD"
    category: "Service Hardening"
    description: "Disable dhcpd"
    check_cmd: ["bash", "-lc", "systemctl is-enabled dhcpd 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now dhcpd 2>/dev/null || true"]
    severity: "low"
    os: "linux"
  - id: "LIN-SVC-005"
    control_id: "LIN.SVC.DNS"
    category: "Service Hardening"
    description: "Disable named (DNS server)"
    check_cmd: ["bash", "-lc", "systemctl is-enabled named 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now named 2>/dev/null || true"]
    severity: "low"
    os: "linux"
  - id: "LIN-SVC-006"
    control_id: "LIN.SVC.LDAPD"
    category: "Service Hardening"
    description: "Disable slapd (LDAP)"
    check_cmd: ["bash", "-lc", "systemctl is-enabled slapd 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now slapd 2>/dev/null || true"]
    severity: "low"
    os: "linux"
  - id: "LIN-SVC-007"
    control_id: "LIN.SVC.NFS"
    category: "Service Hardening"
    description: "Disable nfs-server"
    check_cmd: ["bash", "-lc", "systemctl is-enabled nfs-server 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now nfs-server 2>/dev/null || true"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SVC-008"
    control_id: "LIN.SVC.RPCBIND"
    category: "Service Hardening"
    description: "Disable rpcbind"
    check_cmd: ["bash", "-lc", "systemctl is-enabled rpcbind 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now rpcbind 2>/dev/null || true"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SVC-009"
    control_id: "LIN.SVC.SAMBA"
    category: "Service Hardening"
    description: "Disable smbd (Samba)"
    check_cmd: ["bash", "-lc", "systemctl is-enabled smbd 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now smbd 2>/dev/null || true"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SVC-010"
    control_id: "LIN.SVC.SNMPD"
    category: "Service Hardening"
    description: "Disable snmpd"
    check_cmd: ["bash", "-lc", "systemctl is-enabled snmpd 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now snmpd 2>/dev/null || true"]
    severity: "low"
    os: "linux"
  - id: "LIN-SVC-011"
    control_id: "LIN.SVC.TFTP"
    category: "Service Hardening"
    description: "Disable tftp"
    check_cmd: ["bash", "-lc", "systemctl is-enabled tftp 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now tftp 2>/dev/null || true"]
    severity: "low"
    os: "linux"
  - id: "LIN-SVC-012"
    control_id: "LIN.SVC.APACHE"
    category: "Service Hardening"
    description: "Disable Apache HTTP Server"
    check_cmd: ["bash", "-lc", "systemctl is-enabled apache2 2>/dev/null | grep -q 'disabled' || systemctl is-enabled httpd 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now apache2 2>/dev/null || true; sudo systemctl disable --now httpd 2>/dev/null || true"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SVC-013"
    control_id: "LIN.SVC.NGINX"
    category: "Service Hardening"
    description: "Disable nginx"
    check_cmd: ["bash", "-lc", "systemctl is-enabled nginx 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now nginx 2>/dev/null || true"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SVC-014"
    control_id: "LIN.SVC.XINETD"
    category: "Service Hardening"
    description: "Disable xinetd"
    check_cmd: ["bash", "-lc", "systemctl is-enabled xinetd 2>/dev/null | grep -q 'disabled'"]
    fix_cmd: ["bash", "-lc", "sudo systemctl disable --now xinetd 2>/dev/null || true"]
    severity: "low"
    os: "linux"
  - id: "LIN-SVC-015"
    control_id: "LIN.SVC.X11"
    category: "Service Hardening"
    description: "Disable display manager for servers"
    check_cmd: ["bash", "-lc", "for dm in gdm3 gdm lightdm sddm; do if systemctl is-enabled $dm 2>/dev/null | grep -q 'enabled'; then exit 1; fi; done"]
    fix_cmd: ["bash", "-lc", "for dm in gdm3 gdm lightdm sddm; do sudo systemctl disable --now $dm 2>/dev/null || true; done"]
    severity: "low"
    os: "linux"
  - id: "LIN-TIME-001"
    control_id: "LIN.TIME.SYNC"
    category: "Time Sync"
    description: "chrony or timesyncd active"
    check_cmd: ["bash", "-lc", "systemctl is-active chronyd || systemctl is-active systemd-timesyncd"]
    fix_cmd: ["bash", "-lc", "sudo systemctl enable --now systemd-timesyncd || sudo systemctl enable --now chronyd"]
    severity: "medium"
    os: "linux"
  - id: "LIN-CRON-001"
    control_id: "LIN.CRON.ACTIVE"
    category: "Cron Hardening"
    description: "Cron service active"
    check_cmd: ["bash", "-lc", "systemctl is-active cron || systemctl is-active crond"]
    fix_cmd: ["bash", "-lc", "sudo systemctl enable --now cron || sudo systemctl enable --now crond"]
    severity: "low"
    os: "linux"
  - id: "LIN-NET-001"
    control_id: "LIN.NET.IPV6"
    category: "Network Hardening"
    description: "IPv6 disabled"
    check_cmd: ["bash", "-lc", "sysctl net.ipv6.conf.all.disable_ipv6 | grep -q '= 1'"]
    fix_cmd: ["bash", "-lc", "echo 'net.ipv6.conf.all.disable_ipv6=1' | sudo tee /etc/sysctl.d/99-ntro-ipv6.conf && sudo sysctl -p /etc/sysctl.d/99-ntro-ipv6.conf"]
    severity: "medium"
    os: "linux"
  - id: "LIN-FW-001"
    control_id: "LIN.FW.DEFAULTDENY"
    category: "Firewall"
    description: "UFW enabled default deny"
    check_cmd: ["bash", "-lc", "ufw status | grep -iq 'Status: active' && ufw status | grep -iq 'Default: deny'"]
    fix_cmd: ["bash", "-lc", "sudo ufw --force reset && sudo ufw default deny && sudo ufw --force enable"]
    severity: "high"
    os: "linux"
  - id: "LIN-FW-LOG-001"
    control_id: "LIN.FW.LOG"
    category: "Firewall"
    description: "UFW logging enabled"
    check_cmd: ["bash", "-lc", "ufw status | grep -iq 'Logging: on'"]
    fix_cmd: ["bash", "-lc", "sudo ufw logging on"]
    severity: "medium"
    os: "linux"
  - id: "LIN-FW-LOOP-001"
    control_id: "LIN.FW.LOOPBACK"
    category: "Firewall"
    description: "Loopback allowed"
    check_cmd: ["bash", "-lc", "sudo ufw status numbered | grep -iq 'ALLOW IN 127.0.0.1' || sudo ufw status | grep -iq 'Anywhere on lo' "]
    fix_cmd: ["bash", "-lc", "sudo ufw allow in on lo && sudo ufw allow out on lo"]
    severity: "low"
    os: "linux"
  - id: "LIN-IPTABLES-PERSIST-001"
    control_id: "LIN.FW.IPTABLES_PERSISTENT"
    category: "Firewall"
    description: "iptables-persistent removed"
    check_cmd: ["bash", "-lc", "dpkg -l | grep -q iptables-persistent && exit 1 || true"]
    fix_cmd: ["bash", "-lc", "sudo apt-get -y remove iptables-persistent || true"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SSH-001"
    control_id: "LIN.SSH.ROOTLOGIN"
    category: "SSH Hardening"
    description: "PermitRootLogin no"
    check_cmd: ["bash", "-lc", "grep -Ei '^PermitRootLogin\\s+no' /etc/ssh/sshd_config"]
    fix_cmd: ["bash", "-lc", "sudo sed -i 's/^#\\?PermitRootLogin.*/PermitRootLogin no/' /etc/ssh/sshd_config && sudo systemctl reload sshd || sudo systemctl reload ssh"]
    severity: "high"
    os: "linux"
  - id: "LIN-SSH-002"
    control_id: "LIN.SSH.PASSAUTH"
    category: "SSH Hardening"
    description: "PasswordAuthentication no"
    check_cmd: ["bash", "-lc", "grep -Ei '^PasswordAuthentication\\s+no' /etc/ssh/sshd_config"]
    fix_cmd: ["bash", "-lc", "sudo sed -i 's/^#\\?PasswordAuthentication.*/PasswordAuthentication no/' /etc/ssh/sshd_config && sudo systemctl reload sshd || sudo systemctl reload ssh"]
    severity: "high"
    os: "linux"
  - id: "LIN-SSH-003"
    control_id: "LIN.SSH.BANNER"
    category: "SSH Hardening"
    description: "Banner configured"
    check_cmd: ["bash", "-lc", "grep -Ei '^Banner\\s+' /etc/ssh/sshd_config"]
    fix_cmd: ["bash", "-lc", "echo '/etc/issue' | sudo tee -a /etc/ssh/sshd_config && sudo systemctl reload sshd || sudo systemctl reload ssh"]
    severity: "low"
    os: "linux"
  - id: "LIN-SUDO-001"
    control_id: "LIN.SUDO.LOG"
    category: "Sudo"
    description: "Sudo logs enabled"
    check_cmd: ["bash", "-lc", "grep -E '^Defaults\\s+logfile=' /etc/sudoers /etc/sudoers.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "echo 'Defaults logfile=\"/var/log/sudo.log\"' | sudo tee /etc/sudoers.d/logging"]
    severity: "medium"
    os: "linux"
  - id: "LIN-PAM-001"
    control_id: "LIN.PAM.MINLEN"
    category: "PAM"
    description: "Password length >=12"
    check_cmd: ["bash", "-lc", "grep -E '^minlen\\s*=?\\s*12|^minlen\\s*=?\\s*[1-9][2-9]' /etc/security/pwquality.conf"]
    fix_cmd: ["bash", "-lc", "sudo sed -i 's/^#\\?minlen.*/minlen = 12/' /etc/security/pwquality.conf"]
    severity: "high"
    os: "linux"
  - id: "LIN-AUDITD-001"
    control_id: "LIN.AUD.AUDITD_ACTIVE"
    category: "Auditd"
    description: "auditd active"
    check_cmd: ["bash", "-lc", "systemctl is-active auditd"]
    fix_cmd: ["bash", "-lc", "sudo apt-get -y install auditd || sudo yum -y install audit && sudo systemctl enable --now auditd"]
    severity: "high"
    os: "linux"
  - id: "LIN-AUDITD-002"
    control_id: "LIN.AUD.IMMUTABLE"
    category: "Auditd"
    description: "Immutable rules enforced"
    check_cmd: ["bash", "-lc", "grep -qE '^-e\\s+2' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "echo '-e 2' | sudo tee /etc/audit/rules.d/99-immutable.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "high"
    os: "linux"
  - id: "LIN-AUDITD-003"
    control_id: "LIN.AUD.SUDOERS"
    category: "Auditd"
    description: "Audit sudoers changes"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /etc/sudoers -p wa -k sudoers' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "echo '-w /etc/sudoers -p wa -k sudoers' | sudo tee /etc/audit/rules.d/10-sudoers.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "high"
    os: "linux"
  - id: "LIN-AUDITD-004"
    control_id: "LIN.AUD.PRIVILEGED"
    category: "Auditd"
    description: "Audit privileged commands"
    check_cmd: ["bash", "-lc", "grep -qE '^-a always,exit -F arch=b64 -S execve -C uid!=euid -F euid=0 -k privileged' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "echo '-a always,exit -F arch=b64 -S execve -C uid!=euid -F euid=0 -k privileged' | sudo tee /etc/audit/rules.d/20-priv.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "high"
    os: "linux"
  - id: "LIN-AUDITD-005"
    control_id: "LIN.AUD.PASSWD_SHADOW"
    category: "Auditd"
    description: "Audit passwd/shadow changes"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /etc/passwd -p wa -k passwd|^-w /etc/shadow -p wa -k shadow' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n' '-w /etc/passwd -p wa -k passwd' '-w /etc/shadow -p wa -k shadow' | sudo tee /etc/audit/rules.d/30-ids.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "high"
    os: "linux"
  - id: "LIN-AUDITD-006"
    control_id: "LIN.AUD.USER_GROUP"
    category: "Auditd"
    description: "Audit user/group config changes"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /etc/group -p wa -k group|^-w /etc/gshadow -p wa -k gshadow' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n' '-w /etc/group -p wa -k group' '-w /etc/gshadow -p wa -k gshadow' | sudo tee /etc/audit/rules.d/31-ids.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "medium"
    os: "linux"
  - id: "LIN-AUDITD-007"
    control_id: "LIN.AUD.NETWORK_CONF"
    category: "Auditd"
    description: "Audit network config changes"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /etc/sysctl.conf -p wa -k network|^-w /etc/sysctl.d -p wa -k network' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n' '-w /etc/sysctl.conf -p wa -k network' '-w /etc/sysctl.d -p wa -k network' | sudo tee /etc/audit/rules.d/32-network.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "medium"
    os: "linux"
  - id: "LIN-AUDITD-008"
    control_id: "LIN.AUD.LOG_TAMPER"
    category: "Auditd"
    description: "Audit log tampering"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /var/log -p wa -k logs' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "echo '-w /var/log -p wa -k logs' | sudo tee /etc/audit/rules.d/33-logs.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "medium"
    os: "linux"
  - id: "LIN-AUDITD-009"
    control_id: "LIN.AUD.KMOD"
    category: "Auditd"
    description: "Audit kernel module loading"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /sbin/insmod -p x -k modules|^-w /sbin/modprobe -p x -k modules|^-w /sbin/rmmod -p x -k modules' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n%s\n' '-w /sbin/insmod -p x -k modules' '-w /sbin/modprobe -p x -k modules' '-w /sbin/rmmod -p x -k modules' | sudo tee /etc/audit/rules.d/34-mod.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "medium"
    os: "linux"
  - id: "LIN-AUDITD-010"
    control_id: "LIN.AUD.MOUNT"
    category: "Auditd"
    description: "Audit mount/unmount"
    check_cmd: ["bash", "-lc", "grep -qE '^-a always,exit -F arch=b64 -S mount -k mounts|^-a always,exit -F arch=b64 -S umount2 -k mounts' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n' '-a always,exit -F arch=b64 -S mount -k mounts' '-a always,exit -F arch=b64 -S umount2 -k mounts' | sudo tee /etc/audit/rules.d/35-mount.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "medium"
    os: "linux"
  - id: "LIN-AUDITD-011"
    control_id: "LIN.AUD.TIMECHANGE"
    category: "Auditd"
    description: "Audit time changes"
    check_cmd: ["bash", "-lc", "grep -qE '^-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change|^-w /etc/timezone -p wa -k time-change' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n' '-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change' '-w /etc/timezone -p wa -k time-change' | sudo tee /etc/audit/rules.d/36-time.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "low"
    os: "linux"
  - id: "LIN-AUDITD-012"
    control_id: "LIN.AUD.SETUID"
    category: "Auditd"
    description: "Audit setuid/setgid binary exec"
    check_cmd: ["bash", "-lc", "grep -qE '^-a always,exit -F arch=b64 -S execve -C exe -F euid=0 -k setuid' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "echo '-a always,exit -F arch=b64 -S execve -C exe -F euid=0 -k setuid' | sudo tee /etc/audit/rules.d/37-setuid.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "medium"
    os: "linux"
  - id: "LIN-AUDITD-013"
    control_id: "LIN.AUD.SU_SUDO"
    category: "Auditd"
    description: "Audit su/sudo usage"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /usr/bin/su -p x -k su|^-w /usr/bin/sudo -p x -k sudo' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n' '-w /usr/bin/su -p x -k su' '-w /usr/bin/sudo -p x -k sudo' | sudo tee /etc/audit/rules.d/38-su.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "low"
    os: "linux"
  - id: "LIN-AUDITD-014"
    control_id: "LIN.AUD.SSHD_CONFIG"
    category: "Auditd"
    description: "Audit sshd_config changes"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /etc/ssh/sshd_config -p wa -k ssh' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "echo '-w /etc/ssh/sshd_config -p wa -k ssh' | sudo tee /etc/audit/rules.d/39-ssh.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "medium"
    os: "linux"
  - id: "LIN-AUDITD-015"
    control_id: "LIN.AUD.USERMGMT_TOOLS"
    category: "Auditd"
    description: "Audit user mgmt tools"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /usr/sbin/useradd -p x -k usermgmt|^-w /usr/sbin/usermod -p x -k usermgmt|^-w /usr/sbin/userdel -p x -k usermgmt' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n%s\n' '-w /usr/sbin/useradd -p x -k usermgmt' '-w /usr/sbin/usermod -p x -k usermgmt' '-w /usr/sbin/userdel -p x -k usermgmt' | sudo tee /etc/audit/rules.d/40-user.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "medium"
    os: "linux"
  - id: "LIN-AUDITD-016"
    control_id: "LIN.AUD.GROUPMGMT_TOOLS"
    category: "Auditd"
    description: "Audit group mgmt tools"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /usr/sbin/groupadd -p x -k groupmgmt|^-w /usr/sbin/groupmod -p x -k groupmgmt|^-w /usr/sbin/groupdel -p x -k groupmgmt' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n%s\n' '-w /usr/sbin/groupadd -p x -k groupmgmt' '-w /usr/sbin/groupmod -p x -k groupmgmt' '-w /usr/sbin/groupdel -p x -k groupmgmt' | sudo tee /etc/audit/rules.d/41-group.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "low"
    os: "linux"
  - id: "LIN-AUDITD-017"
    control_id: "LIN.AUD.FILE_ACCESS"
    category: "Auditd"
    description: "Audit sensitive file access"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /etc/hosts -p wa -k files|^-w /etc/hostname -p wa -k files' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n' '-w /etc/hosts -p wa -k files' '-w /etc/hostname -p wa -k files' | sudo tee /etc/audit/rules.d/42-files.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "low"
    os: "linux"
  - id: "LIN-AUDITD-018"
    control_id: "LIN.AUD.NETWORK_BINARIES"
    category: "Auditd"
    description: "Audit network binaries"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /usr/bin/nmcli -p x -k network|^-w /usr/bin/ifconfig -p x -k network' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n' '-w /usr/bin/nmcli -p x -k network' '-w /usr/bin/ifconfig -p x -k network' | sudo tee /etc/audit/rules.d/43-netbin.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "low"
    os: "linux"
  - id: "LIN-AUDITD-019"
    control_id: "LIN.AUD.PACKAGE_MGMT"
    category: "Auditd"
    description: "Audit package installs"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /usr/bin/apt -p x -k pkgmgmt|^-w /usr/bin/yum -p x -k pkgmgmt|^-w /usr/bin/dnf -p x -k pkgmgmt' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n%s\n' '-w /usr/bin/apt -p x -k pkgmgmt' '-w /usr/bin/yum -p x -k pkgmgmt' '-w /usr/bin/dnf -p x -k pkgmgmt' | sudo tee /etc/audit/rules.d/44-pkg.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "low"
    os: "linux"
  - id: "LIN-AUDITD-020"
    control_id: "LIN.AUD.FIREWALL_CONF"
    category: "Auditd"
    description: "Audit firewall config changes"
    check_cmd: ["bash", "-lc", "grep -qE '^-w /etc/ufw -p wa -k firewall|^-w /etc/firewalld -p wa -k firewall' /etc/audit/rules.d/* 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "printf '%s\n%s\n' '-w /etc/ufw -p wa -k firewall' '-w /etc/firewalld -p wa -k firewall' | sudo tee /etc/audit/rules.d/45-fw.rules && sudo augenrules --load || sudo service auditd restart"]
    severity: "medium"
    os: "linux"
  - id: "LIN-RSYSLOG-001"
    control_id: "LIN.LOG.RSYSLOG_FORWARD"
    category: "rsyslog"
    description: "rsyslog active and remote forwarding"
    check_cmd: ["bash", "-lc", "systemctl is-active rsyslog && grep -qE '@@' /etc/rsyslog.d/*.conf 2>/dev/null"]
    fix_cmd: ["bash", "-lc", "sudo apt-get -y install rsyslog || sudo yum -y install rsyslog; echo '*.* @@logserver.example:514' | sudo tee /etc/rsyslog.d/99-remote.conf; sudo systemctl enable --now rsyslog"]
    severity: "medium"
    os: "linux"
  - id: "LIN-LOGROTATE-001"
    control_id: "LIN.LOG.LOGROTATE"
    category: "Logging"
    description: "logrotate configured"
    check_cmd: ["bash", "-lc", "test -s /etc/logrotate.conf"]
    fix_cmd: ["bash", "-lc", "echo '# ensure logrotate installed and configured' && exit 1"]
    severity: "low"
    os: "linux"
  - id: "LIN-AIDE-001"
    control_id: "LIN.INTEGRITY.AIDE"
    category: "Integrity"
    description: "AIDE installed"
    check_cmd: ["bash", "-lc", "command -v aide"]
    fix_cmd: ["bash", "-lc", "sudo apt-get -y install aide || sudo yum -y install aide"]
    severity: "medium"
    os: "linux"
  - id: "LIN-NETMOD-001"
    control_id: "LIN.NET.DISABLE_MODULES"
    category: "Network Hardening"
    description: "Disable dccp, tipc, rds, sctp"
    check_cmd: ["bash", "-lc", "! lsmod | grep -E '(dccp|tipc|rds|sctp)'"]
    fix_cmd: ["bash", "-lc", "printf 'install dccp /bin/true\ninstall tipc /bin/true\ninstall rds /bin/true\ninstall sctp /bin/true\n' | sudo tee /etc/modprobe.d/ntro-net.conf && sudo update-initramfs -u || true"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SYSCTL-003"
    control_id: "LIN.KERN.NET_SYSCTLS"
    category: "Kernel Hardening"
    description: "Network sysctls enforced"
    check_cmd: ["bash", "-lc", "sysctl net.ipv4.tcp_syncookies | grep -q '= 1' && sysctl net.ipv4.conf.all.rp_filter | grep -q '= 1' && sysctl net.ipv4.conf.all.accept_redirects | grep -q '= 0'"]
    fix_cmd: ["bash", "-lc", "sudo tee /etc/sysctl.d/99-ntro-net.conf >/dev/null <<'EOF'\nnet.ipv4.tcp_syncookies=1\nnet.ipv4.conf.all.rp_filter=1\nnet.ipv4.conf.all.accept_redirects=0\nEOF\nsudo sysctl -p /etc/sysctl.d/99-ntro-net.conf"]
    severity: "high"
    os: "linux"
  - id: "LIN-LOG-001"
    control_id: "LIN.LOG.JOURNALD_ROT"
    category: "journald"
    description: "journald rotation configured"
    check_cmd: ["bash", "-lc", "grep -E '^SystemMaxUse=' /etc/systemd/journald.conf"]
    fix_cmd: ["bash", "-lc", "echo 'SystemMaxUse=256M' | sudo tee -a /etc/systemd/journald.conf && sudo systemctl restart systemd-journald"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SSH-004"
    category: "SSH Hardening"
    description: "Strong ciphers configured"
    check_cmd: ["bash", "-lc", "grep -E '^Ciphers' /etc/ssh/sshd_config | grep -qi 'aes256-ctr|chacha20-poly1305@openssh.com'"]
    fix_cmd: ["bash", "-lc", "sudo sed -i '/^#\\?Ciphers.*/d' /etc/ssh/sshd_config; echo 'Ciphers chacha20-poly1305@openssh.com,aes256-ctr' | sudo tee -a /etc/ssh/sshd_config && sudo systemctl reload sshd || sudo systemctl reload ssh"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SSH-005"
    category: "SSH Hardening"
    description: "Strong KEX configured"
    check_cmd: ["bash", "-lc", "grep -E '^KexAlgorithms' /etc/ssh/sshd_config | grep -qi 'curve25519-sha256|diffie-hellman-group14-sha256'"]
    fix_cmd: ["bash", "-lc", "sudo sed -i '/^#\\?KexAlgorithms.*/d' /etc/ssh/sshd_config; echo 'KexAlgorithms curve25519-sha256,diffie-hellman-group14-sha256' | sudo tee -a /etc/ssh/sshd_config && sudo systemctl reload sshd || sudo systemctl reload ssh"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SSH-006"
    category: "SSH Hardening"
    description: "Strong MACs configured"
    check_cmd: ["bash", "-lc", "grep -E '^MACs' /etc/ssh/sshd_config | grep -qi 'hmac-sha2-256|hmac-sha2-512'"]
    fix_cmd: ["bash", "-lc", "sudo sed -i '/^#\\?MACs.*/d' /etc/ssh/sshd_config; echo 'MACs hmac-sha2-256,hmac-sha2-512' | sudo tee -a /etc/ssh/sshd_config && sudo systemctl reload sshd || sudo systemctl reload ssh"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SSH-007"
    category: "SSH Hardening"
    description: "MaxAuthTries <= 3"
    check_cmd: ["bash", "-lc", "grep -E '^MaxAuthTries' /etc/ssh/sshd_config | awk '{print $2}' | awk '{exit !($1<=3)}'"]
    fix_cmd: ["bash", "-lc", "sudo sed -i '/^#\\?MaxAuthTries.*/d' /etc/ssh/sshd_config; echo 'MaxAuthTries 3' | sudo tee -a /etc/ssh/sshd_config && sudo systemctl reload sshd || sudo systemctl reload ssh"]
    severity: "high"
    os: "linux"
  - id: "LIN-SSH-008"
    category: "SSH Hardening"
    description: "MaxSessions <= 10"
    check_cmd: ["bash", "-lc", "grep -E '^MaxSessions' /etc/ssh/sshd_config | awk '{print $2}' | awk '{exit !($1<=10)}'"]
    fix_cmd: ["bash", "-lc", "sudo sed -i '/^#\\?MaxSessions.*/d' /etc/ssh/sshd_config; echo 'MaxSessions 10' | sudo tee -a /etc/ssh/sshd_config && sudo systemctl reload sshd || sudo systemctl reload ssh"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SSH-009"
    category: "SSH Hardening"
    description: "LoginGraceTime <= 30s"
    check_cmd: ["bash", "-lc", "grep -E '^LoginGraceTime' /etc/ssh/sshd_config | awk '{print $2}' | sed 's/s$//' | awk '{exit !($1<=30)}'"]
    fix_cmd: ["bash", "-lc", "sudo sed -i '/^#\\?LoginGraceTime.*/d' /etc/ssh/sshd_config; echo 'LoginGraceTime 30s' | sudo tee -a /etc/ssh/sshd_config && sudo systemctl reload sshd || sudo systemctl reload ssh"]
    severity: "medium"
    os: "linux"
  - id: "LIN-SSH-010"
    category: "SSH Hardening"
    description: "Forwarding disabled"
    check_cmd: ["bash", "-lc", "grep -Ei '^X11Forwarding\\s+no' /etc/ssh/sshd_config && grep -Ei '^AllowTcpForwarding\\s+no' /etc/ssh/sshd_config"]
    fix_cmd: ["bash", "-lc", "sudo sed -i 's/^#\\?X11Forwarding.*/X11Forwarding no/' /etc/ssh/sshd_config; sudo sed -i 's/^#\\?AllowTcpForwarding.*/AllowTcpForwarding no/' /etc/ssh/sshd_config && sudo systemctl reload sshd || sudo systemctl reload ssh"]
    severity: "medium"
    os: "linux"
  - id: "LIN-AUD-PART-001"
    category: "Auditd"
    description: "Audit logs on separate partition"
    check_cmd: ["bash", "-lc", "findmnt /var/log/audit && grep -qE '/var/log/audit' /etc/fstab"]
    fix_cmd: ["bash", "-lc", "echo 'Configure /var/log/audit on separate partition in /etc/fstab' && exit 1"]
    severity: "high"
    os: "linux"
  - id: "LIN-FILE-001"
    control_id: "LIN.MAINT.WORLDWRITABLE"
    category: "System Maintenance"
    description: "No world-writable files"
    check_cmd: ["bash", "-lc", "test -z \"$(find / -xdev -type f -perm -0002 2>/dev/null | head -n 1)\""]
    fix_cmd: ["bash", "-lc", "echo 'Audit and remove world-writable files manually' && exit 1"]
    severity: "medium"
    os: "linux"